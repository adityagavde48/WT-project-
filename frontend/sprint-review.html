<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sprint Review</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Google Font -->
  <link
    href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap"
    rel="stylesheet"
  />

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="sprint-review.css" />
</head>
<body
  class="sprint-body"
  data-role="MANAGER"        <!-- set from backend: MANAGER / OWNER / SCRUM_MASTER / MEMBER -->
  data-project-id="5"       <!-- set from backend -->
  data-username="Aditya"    <!-- optional: for greetings -->
>
  <div class="page-wrapper container-fluid">
    <div class="card-main shadow-lg">
      <div class="glow-orb"></div>

      <!-- NO ACCESS MESSAGE (for non-manager roles) -->
      <div id="noAccessBox" class="no-access-box d-none">
        <h2 class="no-access-title">Restricted Area</h2>
        <p class="no-access-text">
          This sprint review page is only visible to the
          <span class="highlight-role">Owner</span>,
          <span class="highlight-role">Manager</span>, or
          <span class="highlight-role">Scrum Master</span>.
        </p>
        <p class="tiny-label mb-0">
          Please go back to the main dashboard if you are a team member.
        </p>
      </div>

      <!-- MAIN CONTENT WRAPPER (hidden if no access) -->
      <div id="sprintContentWrapper" class="sprint-content-wrapper d-none">
        <!-- HEADER -->
        <header class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
          <div>
            <h1 class="page-title mb-1" id="projectTitle">Project Title</h1>
            <p class="page-subtitle mb-0" id="breadcrumbLine">
              Project Overview • Sprint Review
            </p>
          </div>
          <div class="d-flex flex-column align-items-end gap-1">
            <span class="badge role-pill" id="roleBadge">ROLE</span>
            <div class="d-flex align-items-center gap-2">
              <select
                id="sprintSelect"
                class="form-select form-select-sm sprint-select"
              >
                <option value="">Select Sprint</option>
              </select>
              <span class="tiny-label" id="sprintSmallInfo">
                Choose a sprint to review.
              </span>
            </div>
          </div>
        </header>

        <!-- TOP: Sprint summary + health -->
        <section class="row g-3 mb-3">
          <!-- Sprint Summary -->
          <div class="col-lg-8">
            <div class="card card-section h-100">
              <div
                class="card-header border-0 d-flex justify-content-between align-items-center"
              >
                <div>
                  <h6 class="section-title mb-0" id="sprintNameHeading">
                    Sprint Name
                  </h6>
                  <span class="tiny-label" id="sprintGoal">
                    Sprint goal from backend.
                  </span>
                </div>
                <span class="badge sprint-status-pill" id="sprintStatusPill">
                  STATUS
                </span>
              </div>
              <div class="card-body pt-2">
                <div class="row g-2 mb-2">
                  <div class="col-sm-6">
                    <div class="info-line">
                      <span class="tiny-label">Start Date</span>
                      <span class="info-value" id="sprintStartDate">—</span>
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="info-line">
                      <span class="tiny-label">End Date</span>
                      <span class="info-value" id="sprintEndDate">—</span>
                    </div>
                  </div>
                </div>
                <div class="info-line mb-1">
                  <span class="tiny-label">Days Remaining</span>
                  <span class="info-value" id="sprintDaysRemaining">—</span>
                </div>

                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="tiny-label">Sprint Progress</span>
                  <span
                    class="info-value"
                    id="sprintProgressLabel"
                  >
                    0%
                  </span>
                </div>
                <div class="progress progress-thick mb-3">
                  <div
                    class="progress-bar sprint-progress-bar"
                    id="sprintProgressBar"
                    role="progressbar"
                    style="width: 0%;"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>

                <div class="row g-2 text-center stat-row">
                  <div class="col-3">
                    <div class="stat-card">
                      <div class="stat-label">Planned</div>
                      <div class="stat-value" id="sprintPlannedTasks">0</div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="stat-card">
                      <div class="stat-label">Completed</div>
                      <div class="stat-value text-success" id="sprintCompletedTasks">
                        0
                      </div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="stat-card">
                      <div class="stat-label">In Progress</div>
                      <div class="stat-value" id="sprintInProgressTasks">0</div>
                    </div>
                  </div>
                  <div class="col-3">
                    <div class="stat-card">
                      <div class="stat-label">Blocked</div>
                      <div class="stat-value text-danger" id="sprintBlockedTasks">
                        0
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sprint Health -->
          <div class="col-lg-4">
            <div class="card card-section h-100">
              <div class="card-header border-0">
                <h6 class="section-title mb-0">Sprint Health</h6>
              </div>
              <div class="card-body pt-2 small">
                <div class="info-line">
                  <span class="tiny-label">Overall status</span>
                  <span class="info-value" id="sprintHealthStatus">—</span>
                </div>
                <div class="info-line">
                  <span class="tiny-label">Velocity (story points)</span>
                  <span class="info-value" id="sprintVelocity">—</span>
                </div>

                <hr class="soft-divider my-2" />

                <label class="tiny-label mb-1" for="managerNotesInput">
                  Manager notes for this sprint
                </label>
                <textarea
                  id="managerNotesInput"
                  class="form-control form-control-sm manager-notes"
                  rows="3"
                  placeholder="Any high-level notes, risks or decisions..."
                ></textarea>
                <div class="d-flex justify-content-end mt-2">
                  <button
                    type="button"
                    id="saveNotesBtn"
                    class="btn btn-xs btn-outline-light"
                  >
                    Save notes (frontend)
                  </button>
                </div>
                <p class="tiny-label mt-1 mb-0">
                  Notes are kept in browser only unless you connect a backend.
                </p>
              </div>
            </div>
          </div>
        </section>

        <!-- MIDDLE: Member work + Feedback -->
        <section class="row g-3 mb-3">
          <!-- Member Sprint Work -->
          <div class="col-lg-7">
            <div class="card card-section h-100">
              <div
                class="card-header border-0 d-flex justify-content-between align-items-center"
              >
                <h6 class="section-title mb-0">Member Sprint Work</h6>
                <span class="tiny-label">
                  Click member in main dashboard for deep detail.
                </span>
              </div>
              <div class="card-body pt-2">
                <div class="table-responsive">
                  <table
                    class="table table-sm table-dark align-middle mb-0 table-soft"
                  >
                    <thead class="table-head">
                    <tr>
                      <th>Member</th>
                      <th>Role</th>
                      <th>Tasks (Done / Total)</th>
                      <th>Uploads</th>
                      <th>Feedback</th>
                    </tr>
                    </thead>
                    <tbody id="memberTableBody">
                    <!-- Filled by JS -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Feedback Panel -->
          <div class="col-lg-5">
            <div class="card card-section h-100">
              <div
                class="card-header border-0 d-flex justify-content-between align-items-center"
              >
                <h6 class="section-title mb-0">Feedback & Changes</h6>
                <span class="tiny-label">For this sprint only</span>
              </div>
              <div class="card-body pt-2 d-flex flex-column">
                <!-- List -->
                <div class="feedback-list mb-2" id="feedbackList">
                  <!-- Filled by JS -->
                </div>

                <!-- Add feedback -->
                <div class="mt-auto">
                  <h6 class="tiny-label mb-1">Add feedback</h6>
                  <form id="feedbackForm" class="feedback-form">
                    <div class="mb-1">
                      <select
                        id="feedbackMemberSelect"
                        class="form-select form-select-sm"
                      >
                        <option value="">Select member</option>
                      </select>
                    </div>
                    <div class="mb-1">
                      <input
                        type="text"
                        id="feedbackTaskInput"
                        class="form-control form-control-sm"
                        placeholder="Task / area (optional)"
                      />
                    </div>
                    <div class="mb-1">
                      <textarea
                        id="feedbackCommentInput"
                        class="form-control form-control-sm"
                        rows="2"
                        placeholder="Describe feedback or changes required..."
                      ></textarea>
                    </div>
                    <div class="d-flex align-items-center gap-2 mb-1">
                      <select
                        id="feedbackStatusSelect"
                        class="form-select form-select-sm flex-grow-1"
                      >
                        <option value="OPEN">Open</option>
                        <option value="IN_PROGRESS">In progress</option>
                        <option value="RESOLVED">Resolved</option>
                      </select>
                      <button
                        type="submit"
                        class="btn btn-primary-gradient btn-sm"
                      >
                        Add
                      </button>
                    </div>
                    <div
                      id="feedbackMessage"
                      class="tiny-label mt-1"
                    ></div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- BOTTOM: Sprint tasks + Project summary -->
        <section class="row g-3">
          <!-- Sprint Task Board -->
          <div class="col-lg-9">
            <div class="card card-section h-100">
              <div
                class="card-header border-0 d-flex justify-content-between align-items-center flex-wrap gap-2"
              >
                <h6 class="section-title mb-0">Sprint Task Board</h6>
                <div class="d-flex gap-2 flex-wrap">
                  <select
                    id="taskStatusFilter"
                    class="form-select form-select-sm filter-select"
                  >
                    <option value="">All status</option>
                    <option value="TODO">Todo</option>
                    <option value="IN_PROGRESS">In Progress</option>
                    <option value="REVIEW">In Review</option>
                    <option value="DONE">Done</option>
                  </select>
                  <select
                    id="taskFeedbackFilter"
                    class="form-select form-select-sm filter-select"
                  >
                    <option value="">All tasks</option>
                    <option value="WITH_FEEDBACK">With open feedback</option>
                  </select>
                </div>
              </div>
              <div class="card-body pt-2">
                <div class="table-responsive">
                  <table
                    class="table table-sm table-dark align-middle mb-0 table-soft"
                  >
                    <thead class="table-head">
                    <tr>
                      <th>Title</th>
                      <th>Assignee</th>
                      <th>Status</th>
                      <th>Story Points</th>
                      <th>Priority</th>
                      <th>Last Update</th>
                    </tr>
                    </thead>
                    <tbody id="sprintTaskBody">
                    <!-- Filled by JS -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>

          <!-- Project Summary -->
          <div class="col-lg-3">
            <div class="card card-section h-100">
              <div class="card-header border-0">
                <h6 class="section-title mb-0">Project Summary</h6>
              </div>
              <div class="card-body pt-2 small">
                <div
                  class="d-flex justify-content-between align-items-center mb-1"
                >
                  <span class="tiny-label">Completion</span>
                  <span
                    class="info-value"
                    id="projectCompletionLabel"
                  >
                    0%
                  </span>
                </div>
                <div class="progress progress-thick mb-2">
                  <div
                    class="progress-bar"
                    id="projectCompletionBar"
                    role="progressbar"
                    style="width: 0%;"
                    aria-valuemin="0"
                    aria-valuemax="100"
                  ></div>
                </div>

                <div class="info-line">
                  <span class="tiny-label">Total sprints</span>
                  <span class="info-value" id="projectTotalSprints">0</span>
                </div>
                <div class="info-line">
                  <span class="tiny-label">Current sprint</span>
                  <span class="info-value" id="projectCurrentSprintNumber">—</span>
                </div>
                <div class="info-line">
                  <span class="tiny-label">Total tasks</span>
                  <span class="info-value" id="projectTotalTasks">0</span>
                </div>
                <div class="info-line">
                  <span class="tiny-label">Completed tasks</span>
                  <span class="info-value" id="projectCompletedTasks">0</span>
                </div>

                <hr class="soft-divider my-2" />
                <button
                  type="button"
                  id="backToProjectBtn"
                  class="btn btn-sm btn-outline-light w-100"
                >
                  Back to Project Overview
                </button>
              </div>
            </div>
          </div>
        </section>
      </div>
      <!-- /sprintContentWrapper -->
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  ></script>

  <!-- Custom JS -->
  <script src="sprint-review.js"></script>
</body>
</html>
